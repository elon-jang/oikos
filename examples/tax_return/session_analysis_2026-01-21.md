# 세션 분석 보고서 (2026-01-21)

## 세션 개요

**주요 작업:**
- `/receipt` 명령에 `--template` 옵션 추가
- 비개발자 접근성 향상 방안 논의

**커밋:**
- `a835f1f` feat: /receipt 명령에 --template 옵션 추가

---

## 1. 문서 업데이트 권장

### 1.1 README.md 업데이트

#### `--template` 옵션 테이블 추가 (P1)

**위치:** 옵션 테이블 (약 126행)

**추가 내용:**
```markdown
| `--template 파일` | 템플릿 파일 지정 | `--template my_template.docx` |
```

**근거:** 코드와 `/receipt` 명령어에는 구현되어 있으나, README.md 옵션 테이블에 누락됨

---

#### "비개발자를 위한 대안" 섹션 추가 (P2)

**위치:** "## 문제 해결" 섹션 이후

**추가 내용:**
```markdown
## 비개발자를 위한 대안

플러그인 설치나 명령어 사용이 어려운 경우:

### 1. Claude Code 음성 명령 (현재 가능)
Claude Code에서 말로 요청할 수 있습니다:
- "대상자 목록 보여줘"
- "홍길동 영수증 발행해줘"

### 2. 향후 계획
- **웹 인터페이스**: 브라우저에서 파일 업로드만으로 영수증 생성
- **데스크톱 앱**: 설치 후 GUI로 간편하게 사용
- **Google Sheets 연동**: 스프레드시트에서 바로 생성

GitHub Issues에 의견을 남겨주세요.
```

---

### 1.2 context.md 신규 생성 (P2)

**목적:** 설계 결정 및 제약사항 문서화

**주요 내용:**
- 연도 자동 감지 패턴 (파일명에서 추출)
- 발급번호 규칙 (`YY-NNN`)
- 부부 처리 방식 (쉼표 분리)
- 발행대장 연도별 분리 이유
- 알려진 제약사항

---

## 2. 자동화 기회

### 2.1 승인됨 (신규 구현 필요)

| 제안 | 유형 | 우선순위 | 예상 시간 | 영향도 |
|------|------|----------|-----------|--------|
| Streamlit 웹 UI | Skill | P1 | 2-4시간 | 높음 |
| 데이터 검증 에이전트 | Agent | P1 | 2-3시간 | 높음 |
| 연간 설정 스킬 | Skill | P2 | 2-3시간 | 중간 |
| 이메일 배포 스킬 | Skill | P3 | 3-4시간 | 낮음 |

### 2.2 건너뜀 (이미 존재)

| 제안 | 기존 구현 | 상태 |
|------|-----------|------|
| Enhanced Receipt Command | `/receipt` 명령어 | 완료됨 |
| Receipt Preview Command | `--list` 옵션 | 완료됨 |

---

## 3. 다음 세션 추천 작업

### P1 - 높음 (먼저 처리)

#### 3.1 Streamlit 웹 UI 개발

**설명:** 비개발자가 브라우저에서 영수증 생성 가능하도록 웹 인터페이스 구축

**기능:**
- 템플릿/데이터 파일 업로드
- 대상자 목록 확인 및 선택
- 버튼 클릭으로 영수증 생성
- 결과 다운로드

**완료 기준:**
- [ ] `app.py` 생성 (Streamlit)
- [ ] 파일 업로드 위젯
- [ ] 대상자 선택 UI
- [ ] 생성 버튼 및 다운로드
- [ ] README.md에 사용법 추가

---

#### 3.2 PDF 변환 완성

**설명:** `--pdf` 옵션이 문서화되어 있으나 완전히 구현되지 않음

**완료 기준:**
- [ ] docx2pdf 또는 LibreOffice 변환 테스트
- [ ] 변환 실패 시 명확한 에러 메시지
- [ ] 플랫폼별 설치 방법 문서화

---

#### 3.3 데이터 검증 강화

**설명:** 잘못된 데이터로 영수증 생성 방지

**검증 항목:**
- 필수 컬럼 존재 여부
- 금액 숫자 형식 확인
- 월별 합계 = 연간 총합 검증
- 중복 이름 감지

**완료 기준:**
- [ ] `validate_data_file()` 함수 강화
- [ ] 행 번호와 함께 에러 표시
- [ ] `--skip-validation` 옵션 추가

---

#### 3.4 단위 테스트 추가

**설명:** 핵심 함수 테스트로 신뢰성 확보

**테스트 대상:**
- `extract_year_from_filename()`
- `get_issue_year()`
- `format_amount()`
- `load_data()` (이름 분리, 정렬)
- `add_to_ledger()` (재발행 감지)

**완료 기준:**
- [ ] `test_generate_receipts.py` 생성
- [ ] pytest로 실행 가능
- [ ] 커버리지 70% 이상

---

### P2 - 중간

| 작업 | 설명 |
|------|------|
| 배치 안전 기능 | `--dry-run`, 대량 생성 시 확인 프롬프트 |
| context.md 생성 | 설계 결정 문서화 |
| 데스크톱 앱 조사 | PyInstaller 패키징 가능성 평가 |
| Google Sheets 조사 | API 연동 복잡도 평가 |

### P3 - 낮음

| 작업 | 설명 |
|------|------|
| 이메일 배포 | SMTP로 영수증 자동 발송 |
| 진행률 표시 | tqdm으로 대량 생성 시 진행 상황 표시 |
| 템플릿 검증 도구 | placeholder 누락 감지 |

---

## 4. 기술 학습

### 4.1 argparse `--template` 패턴

선택적 파일 경로 옵션으로 유연성 확보:

```python
parser.add_argument("--template",
                    help="템플릿 파일 경로 (예: my_template.docx)")

template_file = args.template if args.template else TEMPLATE_FILE
```

**활용:** 기본값이 있지만 사용자가 재정의할 수 있는 CLI 옵션

---

### 4.2 사용자 접근성 계층

기술 수준별 인터페이스 선택:

| 인터페이스 | 대상 | 장점 | 단점 |
|-----------|------|------|------|
| Python CLI | 개발자 | 완전한 제어 | 명령어 암기 필요 |
| Claude 명령 | 기술 친화적 | 자연어 사용 | Claude Code 필요 |
| 웹 UI | 모든 사용자 | 브라우저만 필요 | 호스팅 필요 |
| 데스크톱 앱 | 모든 사용자 | 오프라인 가능 | 배포 복잡 |
| Google Sheets | 스프레드시트 사용자 | 익숙한 환경 | API 설정 필요 |

---

### 4.3 템플릿 기반 문서 생성

**장점:**
- 비개발자가 Word에서 레이아웃 수정 가능
- WYSIWYG 편집
- 포맷 자동 보존
- 코드 변경 없이 디자인 변경

**적합한 경우:**
- 구조화된 문서 (영수증, 증명서, 보고서)
- 비개발자가 템플릿 관리
- 빠른 반복 작업

---

## 5. 인터페이스 옵션 비교

세션에서 논의된 비개발자 접근성 향상 방안:

| 옵션 | 난이도 | 개발 시간 | 유지보수 | 추천 |
|------|--------|-----------|----------|------|
| Streamlit 웹 UI | ⭐ | 2-4시간 | 낮음 | **1순위** |
| 데스크톱 앱 | ⭐⭐ | 4-6시간 | 중간 | 2순위 |
| Google Sheets | ⭐⭐ | 3-4시간 | 중간 | 3순위 |

**결론:** Streamlit 웹 UI를 먼저 구현하고, 피드백에 따라 다른 옵션 검토

---

## 6. 알려진 이슈

| 이슈 | 영향 | 우선순위 |
|------|------|----------|
| PDF 변환 미완성 | 사용자 혼란 | P1 |
| 데이터 검증 부족 | 잘못된 영수증 | P1 |
| 테스트 없음 | 회귀 위험 | P1 |
| 대량 생성 안전장치 없음 | 실수 가능 | P2 |

---

## 7. 파일 변경 이력

### 수정된 파일

| 파일 | 변경 내용 |
|------|-----------|
| `generate_receipts.py` | `--template` 옵션 추가, `validate_template()` 매개변수화 |
| `.claude/commands/receipt.md` | `--template`, `--data` 옵션 예시 추가 |

### 영향받는 문서 (업데이트 필요)

| 파일 | 필요한 변경 |
|------|-------------|
| `README.md` | `--template` 옵션 테이블 추가 |
| `시작하기_가이드.md` | 비개발자 대안 섹션 추가 |

---

## 8. 다음 세션 시작 가이드

```bash
# 1. 현재 상태 확인
cd /Users/elon/elon/ai/projects/church/oikos/examples/tax_return
git status
python generate_receipts.py --list --data sample_income_summary.xlsx

# 2. Streamlit 설치 (웹 UI 개발 시)
pip install streamlit

# 3. 테스트 실행 (테스트 추가 후)
pip install pytest
pytest test_generate_receipts.py
```

---

## 9. 미해결 질문

1. Streamlit 앱을 로컬에서만 실행할지, 클라우드 배포할지?
2. PDF 출력이 필수인지, DOCX만으로 충분한지?
3. 일반적인 배치 크기는? (진행률 표시 우선순위 결정)
4. 웹 UI, 데스크톱 앱, Google Sheets 중 어떤 것을 우선 구현할지?

---

*생성일: 2026-01-21*
*도구: Claude Code Session Wrap-up*
