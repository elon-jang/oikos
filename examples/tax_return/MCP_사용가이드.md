# MCP 서버 사용 가이드

Claude Desktop에서 자연어로 기부금 영수증을 발행하는 방법을 안내합니다.

## 목차

1. [설치 후 첫 사용](#설치-후-첫-사용)
2. [자주 쓰는 명령어](#자주-쓰는-명령어)
3. [상세 기능 설명](#상세-기능-설명)
4. [문제 해결](#문제-해결)

---

## 설치 후 첫 사용

### 1. 데이터 폴더 확인

설치 후 생성된 데이터 폴더를 확인합니다:

```
~/기부금영수증/           (macOS)
%USERPROFILE%\기부금영수증\  (Windows)
```

### 2. 필요한 파일 준비

데이터 폴더에 다음 파일을 넣으세요:

| 파일 | 설명 | 예시 |
|------|------|------|
| `donation_receipt_template.docx` | 영수증 템플릿 | [템플릿_만들기_가이드.md](템플릿_만들기_가이드.md) 참고 |
| `YYYY_income_summary.xlsx` | 헌금 데이터 | 2025_income_summary.xlsx |

### 3. Claude Desktop 재시작

설정이 적용되도록 Claude Desktop을 완전히 종료한 후 다시 실행합니다.

### 4. 첫 테스트

Claude Desktop에서 다음과 같이 말해보세요:

```
영수증 발행 대상자 목록 보여줘
```

---

## 자주 쓰는 명령어

### 대상자 확인

```
영수증 발행 대상자가 몇 명이야?
대상자 목록 보여줘
올해 영수증 대상자 확인해줘
```

### 영수증 생성

```
홍길동 영수증 발행해줘
홍길동, 김철수 영수증 발행해줘
전체 영수증 발행해줘
```

### 미리보기

```
홍길동 영수증 미리보기 해줘
강신애 영수증 내용 확인해줘
```

### 데이터 검증

```
데이터 파일 검증해줘
헌금 데이터 확인해줘
템플릿 확인해줘
```

### 발행 이력

```
발행 이력 보여줘
강신애 발행 이력 확인해줘
올해 몇 건 발행했어?
```

---

## 상세 기능 설명

### 1. 대상자 목록 조회 (`list_recipients`)

**기능:** 영수증 발행 대상자 수와 총 금액을 확인합니다.

**말하는 방식:**
- "대상자 목록 보여줘"
- "영수증 발행할 사람 몇 명이야?"

**응답 예시:**
```
총 94명의 대상자가 있습니다.
총 금액: 45,000,000원
데이터 파일: 2025_income_summary.xlsx

상세 목록은 데이터 파일을 직접 확인하세요.
```

> ⚠️ 개인정보 보호를 위해 이름 목록은 표시하지 않습니다.

---

### 2. 영수증 생성 (`generate_receipt`)

**기능:** 특정 사람의 영수증을 생성합니다.

**말하는 방식:**
- "홍길동 영수증 발행해줘"
- "강신애 영수증 만들어줘"

**응답 예시:**
```
✅ 영수증이 생성되었습니다.
발급번호: 26-042
파일: ~/기부금영수증/receipts/기부금영수증_홍길동.docx
발행대장에 기록되었습니다.
```

**여러 명 발행:**
```
홍길동, 김철수, 이영희 영수증 발행해줘
```

---

### 3. 전체 영수증 생성 (`generate_all_receipts`)

**기능:** 모든 대상자의 영수증을 한 번에 생성합니다.

**말하는 방식:**
- "전체 영수증 발행해줘"
- "모든 사람 영수증 만들어줘"

**응답 예시 (확인 전):**
```
94명의 영수증을 생성합니다.
계속하려면 "확인" 또는 "네"라고 말씀해주세요.
```

**응답 예시 (확인 후):**
```
✅ 94명의 영수증이 생성되었습니다.
폴더: ~/기부금영수증/receipts/
발행대장: ~/기부금영수증/발행대장_2026.xlsx
```

---

### 4. 영수증 미리보기 (`preview_receipt`)

**기능:** 파일을 생성하지 않고 영수증 내용을 미리 확인합니다.

**말하는 방식:**
- "홍길동 영수증 미리보기 해줘"
- "강신애 영수증 내용 확인해줘"

**응답 예시:**
```
┌─────────────────────────────────────┐
│        기 부 금 영 수 증             │
├─────────────────────────────────────┤
│ 발급번호: 26-042
│ 성명: 홍길동
├─────────────────────────────────────┤
│ 기부 내역:
│   1월: 100,000원
│   2월: 100,000원
│   ...
│   12월: 100,000원
│ ───────────────────────────────────
│ 합계: 1,200,000원
└─────────────────────────────────────┘

실제 생성하려면 "홍길동 영수증 발행해줘"라고 말씀하세요.
```

---

### 5. 데이터 검증 (`validate_data`)

**기능:** 헌금 데이터 파일의 유효성을 검사합니다.

**말하는 방식:**
- "데이터 파일 검증해줘"
- "헌금 데이터 확인해줘"

**검사 항목:**
- 필수 컬럼 존재 여부 (이름, 1월~12월, 연간 총합)
- 금액이 숫자인지 확인
- 음수 값 확인
- 월별 합계와 연간 총합 일치 여부
- 중복 이름 확인

**응답 예시 (정상):**
```
✅ 데이터 파일이 유효합니다.
파일: 2025_income_summary.xlsx
총 94행
```

**응답 예시 (경고):**
```
⚠️ 데이터 파일에 2개 경고가 있습니다.
- 행 15: 월별 합계와 연간 총합이 다름
- 중복된 이름 1건

파일을 직접 확인해주세요.
```

---

### 6. 템플릿 검증 (`validate_template`)

**기능:** Word 템플릿 파일의 유효성을 검사합니다.

**말하는 방식:**
- "템플릿 확인해줘"
- "영수증 템플릿 검증해줘"

**응답 예시:**
```
✅ 템플릿 파일이 유효합니다.
파일: donation_receipt_template.docx

필수 placeholder:
- {{receipt_no}}, {{name}}
- {{month_1}} ~ {{month_12}}
- {{total}}
```

---

### 7. 발행 이력 조회 (`get_history`)

**기능:** 영수증 발행 이력을 확인합니다.

**말하는 방식:**
- "발행 이력 보여줘"
- "올해 영수증 몇 건 발행했어?"

**응답 예시:**
```
2026년 발행 이력:
- 총 발행: 98건
- 대상자: 94명
- 재발행: 4건
- 최근 발행: 2026-01-21 10:30:00

상세 내역은 발행대장_2026.xlsx를 확인하세요.
```

---

### 8. 특정인 이력 조회 (`get_person_history`)

**기능:** 특정 사람의 발행 이력을 확인합니다.

**말하는 방식:**
- "강신애 발행 이력 확인해줘"
- "홍길동 영수증 발행했었어?"

**응답 예시:**
```
강신애님의 2026년 발행 이력:
- 발행 여부: ✅ 발행됨
- 발급번호: 26-001
- 발행일: 2026-01-20 18:30:00
- 재발행: 1회
```

---

## 문제 해결

### "데이터 파일을 찾을 수 없습니다"

1. 데이터 폴더 경로 확인:
   - macOS: `~/기부금영수증/`
   - Windows: `%USERPROFILE%\기부금영수증\`

2. 파일명 형식 확인:
   - `YYYY_income_summary.xlsx` (예: `2025_income_summary.xlsx`)

3. 파일이 있는데도 안 되면:
   - Claude Desktop 재시작

### "템플릿 파일이 없습니다"

1. `donation_receipt_template.docx` 파일이 데이터 폴더에 있는지 확인
2. 파일명이 정확한지 확인 (대소문자, 공백)

### "Docker 연결 실패"

1. Docker Desktop이 실행 중인지 확인
2. 메뉴바(macOS) 또는 시스템 트레이(Windows)에서 Docker 아이콘 확인
3. Docker Desktop 재시작 후 다시 시도

### "MCP 서버를 찾을 수 없습니다"

1. `claude_desktop_config.json` 파일 확인:
   - macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`
   - Windows: `%APPDATA%\Claude\claude_desktop_config.json`

2. 설정 내용 확인:
   ```json
   {
     "mcpServers": {
       "oikos-receipt": {
         "command": "docker",
         "args": ["run", "-i", "--rm", "-v", "...:/data", "oikos-receipt:latest"]
       }
     }
   }
   ```

3. Claude Desktop 완전 종료 후 재시작

### "이름을 찾을 수 없습니다"

1. 이름 철자가 정확한지 확인
2. Excel 파일에서 이름 확인 (공백, 특수문자)
3. 부부 이름인 경우 쉼표로 구분되어 있는지 확인

---

## 팁

### 효율적인 사용법

1. **먼저 검증**: 영수증 발행 전 데이터 검증을 먼저 실행
2. **미리보기 활용**: 전체 발행 전 몇 명 미리보기로 확인
3. **발행 이력 확인**: 재발행 전 이미 발행했는지 확인

### 연간 작업 순서

```
1. "데이터 파일 검증해줘"
2. "대상자 목록 보여줘"
3. "홍길동 영수증 미리보기 해줘" (샘플 확인)
4. "전체 영수증 발행해줘"
5. "발행 이력 보여줘" (확인)
```

### 개인정보 보호

- 이름과 금액 상세 정보는 Claude 응답에 표시되지 않습니다
- 상세 정보는 로컬 파일(Excel, 발행대장)에서 확인하세요
- 모든 데이터 처리는 로컬 컴퓨터에서 수행됩니다
