# MCP 서버 사용 가이드

> **Claude Desktop에서 대화하듯이 영수증을 발행하세요!**
>
> "홍길동 영수증 만들어줘" 한마디면 끝!

---

## 목차

1. [설치 후 첫 사용](#설치-후-첫-사용)
2. [이렇게 말해보세요](#이렇게-말해보세요)
3. [상세 기능 설명](#상세-기능-설명)
4. [문제 해결](#문제-해결)
5. [꿀팁](#꿀팁)

---

## 설치 후 첫 사용

### 1. 데이터 폴더 확인

설치가 완료되면 새 폴더가 생깁니다:

| 운영체제 | 폴더 위치 |
|---------|----------|
| Mac | `~/donation_receipts/` |
| Windows | `내 문서\donation_receipts\` |

### 2. 필요한 파일 넣기

이 폴더에 두 파일을 넣어주세요:

| 파일 | 설명 | 예시 |
|------|------|------|
| 영수증 템플릿 | Word 양식 파일 | `donation_receipt_template.docx` |
| 헌금 데이터 | Excel 파일 | `2025_income_summary.xlsx` |

> **템플릿 만드는 법**: [템플릿_만들기_가이드.md](템플릿_만들기_가이드.md) 참고

### 3. Claude Desktop 재시작

**중요!** 파일을 넣은 후 Claude Desktop을 완전히 종료했다가 다시 실행하세요.

### 4. 첫 테스트

Claude Desktop에서 이렇게 말해보세요:

```
나: 영수증 발행 대상자가 몇 명이야?

Claude: 총 94명의 대상자가 있습니다.
        전체 헌금 총액은 45,000,000원이에요.
```

여기까지 됐으면 성공!

---

## 이렇게 말해보세요

Claude에게 자연스럽게 말하면 됩니다. 명령어를 외울 필요 없어요!

### 대상자 확인하기

```
"영수증 발행 대상자가 몇 명이야?"
"대상자 목록 보여줘"
"올해 영수증 대상자 확인해줘"
```

### 영수증 만들기

```
"홍길동 영수증 발행해줘"
"홍길동, 김철수, 이영희 영수증 발행해줘"
"전체 영수증 발행해줘"
```

### 미리 확인하기

```
"홍길동 영수증 미리보기 해줘"
"강신애 영수증 내용 확인해줘"
```

### 검증하기

```
"데이터 파일 확인해줘"
"템플릿 괜찮은지 봐줘"
```

### 이력 확인하기

```
"발행 이력 보여줘"
"강신애 영수증 발행했었어?"
"올해 몇 건 발행했어?"
```

---

## 상세 기능 설명

### 1. 대상자 목록 조회

**이렇게 말하면:**
```
"대상자 목록 보여줘"
```

**Claude가 이렇게 답해요:**
```
총 94명의 대상자가 있습니다.
총 금액: 45,000,000원
데이터 파일: 2025_income_summary.xlsx
```

> 개인정보 보호를 위해 이름 목록은 보여주지 않아요.
> 상세 목록은 Excel 파일에서 직접 확인하세요.

---

### 2. 영수증 생성

**이렇게 말하면:**
```
"홍길동 영수증 발행해줘"
```

**Claude가 이렇게 답해요:**
```
영수증이 생성되었습니다!
발급번호: 26-042
파일: ~/donation_receipts/receipts/기부금영수증_홍길동.docx
발행대장에 기록되었습니다.
```

**여러 명도 가능해요:**
```
"홍길동, 김철수, 이영희 영수증 발행해줘"
```

---

### 3. 전체 영수증 생성

**이렇게 말하면:**
```
"전체 영수증 발행해줘"
```

**Claude가 먼저 확인해요:**
```
94명의 영수증을 생성합니다.
계속하려면 "네" 또는 "확인"이라고 말씀해주세요.
```

**"네"라고 하면:**
```
완료! 94명의 영수증이 생성되었습니다.
폴더: ~/donation_receipts/receipts/
발행대장: ~/donation_receipts/발행대장_2026.xlsx
```

---

### 4. 영수증 미리보기

파일을 만들지 않고 내용만 확인하고 싶을 때!

**이렇게 말하면:**
```
"홍길동 영수증 미리보기 해줘"
```

**Claude가 이렇게 답해요:**
```
┌─────────────────────────────────────┐
│        기 부 금 영 수 증             │
├─────────────────────────────────────┤
│ 발급번호: 26-042
│ 성명: 홍길동
├─────────────────────────────────────┤
│ 기부 내역:
│   1월: 100,000원
│   2월: 100,000원
│   ...
│   12월: 100,000원
│ ─────────────────────────────────
│ 합계: 1,200,000원
└─────────────────────────────────────┘

실제 생성하려면 "홍길동 영수증 발행해줘"라고 말씀하세요.
```

---

### 5. 데이터 검증

발행 전에 데이터가 올바른지 확인!

**이렇게 말하면:**
```
"데이터 파일 검증해줘"
```

**정상이면:**
```
데이터 파일이 유효합니다!
파일: 2025_income_summary.xlsx
총 94행
```

**문제가 있으면:**
```
데이터 파일에 2개 경고가 있습니다.
- 행 15: 월별 합계와 연간 총합이 다름
- 중복된 이름 1건

파일을 직접 확인해주세요.
```

---

### 6. 템플릿 검증

템플릿이 올바른지 확인!

**이렇게 말하면:**
```
"템플릿 확인해줘"
```

**Claude가 이렇게 답해요:**
```
템플릿 파일이 유효합니다!
파일: donation_receipt_template.docx

필수 placeholder 확인 완료:
- {{receipt_no}}, {{name}}
- {{month_1}} ~ {{month_12}}
- {{total}}
```

---

### 7. 발행 이력 조회

올해 몇 건 발행했는지 확인!

**이렇게 말하면:**
```
"발행 이력 보여줘"
```

**Claude가 이렇게 답해요:**
```
2026년 발행 이력:
- 총 발행: 98건
- 대상자: 94명
- 재발행: 4건
- 최근 발행: 2026-01-21 10:30:00

상세 내역은 발행대장_2026.xlsx를 확인하세요.
```

---

### 8. 특정인 이력 조회

누가 발행됐는지 확인!

**이렇게 말하면:**
```
"강신애 영수증 발행했었어?"
```

**Claude가 이렇게 답해요:**
```
강신애님의 2026년 발행 이력:
- 발행 여부: 발행됨
- 발급번호: 26-001
- 발행일: 2026-01-20 18:30:00
- 재발행: 1회
```

---

## 발급번호 규칙

발급번호는 **이름 가나다순**으로 부여됩니다 (발행 순서 아님).

```
26-001  강신애    ← 가나다순 1번째
26-042  홍길동    ← 가나다순 42번째
```

**장점:**
- 같은 사람은 항상 같은 번호
- 재발행 시 동일 번호 유지
- 누구를 먼저 발행해도 번호 변동 없음

---

## 문제 해결

### "데이터 파일을 찾을 수 없습니다"

**확인할 것:**
1. 파일이 `~/donation_receipts/` 폴더에 있나요?
2. 파일명이 `YYYY_income_summary.xlsx` 형식인가요?
   - 예: `2025_income_summary.xlsx`
3. Claude Desktop을 재시작했나요?

---

### "템플릿 파일이 없습니다"

**확인할 것:**
1. `donation_receipt_template.docx` 파일이 데이터 폴더에 있나요?
2. 파일명이 정확한가요? (대소문자, 공백 주의)

---

### "Docker 연결 실패"

**확인할 것:**
1. Docker Desktop이 실행 중인가요?
2. 화면 상단(Mac) 또는 작업표시줄(Windows)에 고래 아이콘이 보이나요?
3. Docker Desktop을 재시작해보세요.

---

### "MCP 서버를 찾을 수 없습니다"

설정 파일에 문제가 있을 수 있어요.

**설정 파일 위치:**
- Mac: `~/Library/Application Support/Claude/claude_desktop_config.json`
- Windows: `%APPDATA%\Claude\claude_desktop_config.json`

**설정 내용 확인 (Docker 방식):**
```json
{
  "mcpServers": {
    "oikos-receipt": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "-v", "경로:/data", "joomanba/oikos-receipt:latest"]
    }
  }
}
```

**설정 내용 확인 (Python 방식):**
```json
{
  "mcpServers": {
    "oikos-receipt": {
      "command": "/bin/bash",
      "args": ["-c", "cd /path/to/tax_return && DATA_DIR=/path/to/data python3 -m mcp_server.server"]
    }
  }
}
```

> Docker 연결 문제가 발생하면 Python 방식을 권장합니다. 자세한 내용: [PYTHON.md](PYTHON.md)

설정 수정 후 Claude Desktop을 완전히 종료하고 다시 실행하세요.

---

### "이름을 찾을 수 없습니다"

**확인할 것:**
1. 이름 철자가 정확한가요?
2. Excel 파일에서 이름 확인 (공백, 특수문자)
3. 부부 이름이면 쉼표(`,`)로 구분되어 있나요?

---

## 꿀팁

### 효율적인 작업 순서

```
1. "데이터 파일 검증해줘"          ← 먼저 검증!
2. "대상자 목록 보여줘"            ← 몇 명인지 확인
3. "홍길동 영수증 미리보기 해줘"    ← 샘플 확인
4. "전체 영수증 발행해줘"          ← 전체 발행
5. "발행 이력 보여줘"              ← 결과 확인
```

### 재발행이 필요할 때

이미 발행한 사람도 다시 발행할 수 있어요:

```
"홍길동 영수증 발행해줘"
```

발행대장에 "재발행"으로 자동 기록됩니다.

### 개인정보 보호

- 이름과 금액 상세 정보는 Claude 응답에 표시되지 않아요
- 상세 정보는 Excel 파일과 발행대장에서 확인하세요
- 모든 데이터 처리는 여러분 컴퓨터에서만 이루어집니다

---

## 더 알아보기

| 문서 | 설명 |
|------|------|
| [README.md](../README.md) | 프로젝트 개요 |
| [Docker 가이드](DOCKER.md) | Docker로 MCP 서버 실행 |
| [Python 가이드](PYTHON.md) | Python으로 MCP 서버 실행 |
| [CLI 가이드](CLI_가이드.md) | 터미널에서 직접 실행 |
| [템플릿 만들기](템플릿_만들기_가이드.md) | 영수증 템플릿 작성법 |

---

**문의사항이 있으시면 GitHub Issues에 남겨주세요:**
https://github.com/elon-jang/oikos/issues

**Made with love for church communities**
